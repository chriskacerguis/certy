# Application Defaults.
# You can leave everything below as-is, execept where it says REQUIRED (you should set these)

# -----------------------------
# Server
# -----------------------------
PORT=3000
NODE_ENV=development              # development | production | test
TRUST_PROXY=false                 # set true if behind a reverse proxy (enables secure cookies)
SESSION_SECRET=change_me          # REQUIRED: random string for session cookies

# -----------------------------
# Logging & Rate Limiting
# -----------------------------
LOG_LEVEL=info                    # debug | info | warn | error
LOG_PRETTY=true                   # dev-friendly logs (requires: npm i -D pino-pretty)
HTTP_LOG_SAMPLE_RATE=10           # log 1 in N successful 2xx/3xx requests; errors always logged
HTTP_LOG_IGNORE_PATHS=/healthz,/favicon.ico,/public
RATE_LIMIT_MAX=120

# -----------------------------
# Local CA / SQLite keystore
# -----------------------------
# UI: set to true to show the Initialize/Destroy CA cards
ENABLE_CA_LIFECYCLE=true

# Base folder for CA runtime files (contains the SQLite DB by default)
LOCAL_CA_DIR=.local-ca
# SQLite DB path (back up this file). Defaults to "$LOCAL_CA_DIR/ca.db" if not set
LOCAL_CA_DB=.local-ca/ca.db
# Directory containing DB migrations
MIGRATIONS_DIR=src/migrations
# REQUIRED: encrypt private keys in DB at rest (>= 8 chars recommended)
KEYSTORE_SECRET=change_me
# Optional: during rotation, set previous secret to allow decrypting existing entries
# After rotation, unset this.
KEYSTORE_SECRET_OLD=

# Validities (days)
CA_ROOT_DAYS=3650                 # ~10 years
CA_INT_DAYS=1825                  # ~5 years
CA_LEAF_DAYS=365                  # default leaf cert validity

# Key sizes (RSA). Leaf issuance currently uses RSA.
CA_ROOT_KEY_BITS=4096
CA_INT_KEY_BITS=3072

# -----------------------------
# Authentication (OIDC) - ALL REQUIRED FOR EXTERNAL OIDC
# -----------------------------
# When running your app on the host and an OIDC dev server in Docker,
# point issuer to localhost (NOT the container name).
AUTH_OPTIONAL=false
OIDC_ISSUER=http://localhost:8080 # e.g., http://localhost:8080
OIDC_CLIENT_ID=client             # from your OIDC provider
OIDC_CLIENT_SECRET=secret         # from your OIDC provider
OIDC_REDIRECT_URI=http://localhost:3000/auth/callback
OIDC_SCOPES=openid profile email

# -----------------------------
# Email (SMTP) for S/MIME delivery
# -----------------------------
# Leave SMTP_HOST blank to DISABLE the "Email .p12 to recipient" option in the UI.
SMTP_HOST=
SMTP_PORT=587
SMTP_SECURE=false                 # true for port 465; false for 587/1025/etc
SMTP_USER=
SMTP_PASS=
SMTP_FROM="Certy <no-reply@example.com>"

# -----------------------------
# CRL publishing to S3 (optional)
# -----------------------------
S3_CRL_ENABLE=false               # set true to enable the Publish to S3 button
S3_CRL_BUCKET=                    # required when enabled (e.g., my-public-bucket)
S3_CRL_KEY=crl/intermediate.crl.pem
S3_CRL_REGION=us-east-1
S3_CRL_PUBLIC_URL=                # optional explicit public URL (also embedded in certs as cRLDistributionPoints)
S3_CRL_CACHE_CONTROL=public, max-age=300
S3_CRL_ACL=public-read            # remove or change if bucket enforces bucket-owner-full-control
S3_CRL_ENDPOINT=                  # optional (e.g., http://localhost:9000 for MinIO)
S3_CRL_FORCE_PATH_STYLE=false     # true for many S3-compatible servers (MinIO)

# AWS credentials: use the default chain (env or shared config/credentials)
# AWS_ACCESS_KEY_ID=
# AWS_SECRET_ACCESS_KEY=
# AWS_SESSION_TOKEN=

# -----------------------------
# ACME (HTTP-01) â€” internal/dev
# -----------------------------
ACME_ENABLE=true                  # set true to enable /acme/*
ACME_HTTP_VERIFY_TIMEOUT_MS=5000  # HTTP-01 fetch timeout